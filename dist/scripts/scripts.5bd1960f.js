"use strict";angular.module("regformApp",["ngAnimate","ui.router","ui.mask","LocalStorageModule"]).config(["localStorageServiceProvider",function(a){a.setPrefix("regform")}]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("form",{url:"/form",templateUrl:"views/form.html",controller:"FormCtrl"}).state("form.step1",{url:"/step1",templateUrl:"views/form-step1.html"}).state("form.step2",{url:"/step2",templateUrl:"views/form-step2.html"}).state("form.step3",{url:"/step3",templateUrl:"views/form-step3.html"}).state("form.step4",{url:"/step4",templateUrl:"views/form-step4.html"}),b.otherwise("/form/step1")}]),angular.module("regformApp").directive("autoFocus",["$timeout",function(a){return{restrict:"AC",link:function(b,c){a(function(){c[0].focus()},0)}}}]).filter("phone",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d,e;switch(b.length){case 10:c=1,d=b.slice(0,3),e=b.slice(3);break;case 11:c=b[0],d=b.slice(1,4),e=b.slice(4);break;case 12:c=b.slice(0,3),d=b.slice(3,5),e=b.slice(5);break;default:return a}return 1===c&&(c=""),e=e.slice(0,3)+"-"+e.slice(3,5)+"-"+e.slice(5),(c+" ("+d+") "+e).trim()}}).directive("validNumber",function(){return{require:"?ngModel",link:function(a,b,c,d){d&&(d.$parsers.push(function(a){var b=a.replace(/[^0-9]+/g,"");return c.size&&b.length>c.size&&(b=b.slice(0,c.size)),a!==b&&(d.$setViewValue(b),d.$render()),b}),b.bind("keypress",function(a){32===a.keyCode&&a.preventDefault()}))}}}).controller("FormCtrl",["$scope","$state","localStorageService",function(a,b,c){function d(a){var b=Date.parse(a);if(isNaN(b))return!1;var c=a.split("/");if(3!==c.length)return!1;var d=parseInt(c[0],10),e=parseInt(c[1],10),f=parseInt(c[2],10);return 4!==f.toString().length?!1:(b=new Date(f,d-1,e),b.getFullYear()===f&&b.getMonth()+1===d&&b.getDate()===e)}a.formData={},a.validSteps={formStep1:!1,formStep2:!1,formStep3:!1},a.$on("$stateChangeStart",function(c,d){"form"===d.name&&(c.preventDefault(),b.go("form.step1")),("form.step2"!==d.name||a.validSteps.formStep1)&&("form.step3"!==d.name||a.validSteps.formStep2)?"form.step4"!==d.name||a.validSteps.formStep3||c.preventDefault():c.preventDefault()});var e=c.get("formData");a.formData=e||{},a.isValid=function(a,b){return a[b].$dirty&&a[b].$valid},a.isInvalid=function(a,b){return a[b].$dirty&&a[b].$invalid},a.validState=function(b,c){var d="";return a.isValid(b,c)?d="has-success":a.isInvalid(b,c)&&(d="has-error"),a.validSteps[b.$name]=b.$valid,d},a.submitStep1=function(c){a.formData.login||(c.login.$dirty=!0),a.formData.email||(c.email.$dirty=!0),a.formData.password||(c.password.$dirty=!0),a.formData.password&&!a.formData.passwordConfirm&&(c.passwordConfirm.$dirty=!0),a.validSteps.formStep1=c.$valid,c.$valid&&b.go("form.step2")},a.updateBirthdate=function(b){var c=""+a.formData.birthDay+"/"+a.formData.birthMonth+"/"+a.formData.birthYear;b.birthdate.$dirty=!0,d(c)?(b.birthdate.$setValidity("date",!0),c=""+a.formData.birthYear+"-"+("0"+a.formData.birthMonth).slice(-2)+"-"+("0"+a.formData.birthDay).slice(-2)+"T00:00:00+0000",a.formData.birthdate=new Date(c)):(b.birthdate.$setValidity("date",!1),a.formData.birthdate=null)},a.submitStep2=function(c){a.formData.name||(c.name.$dirty=!0),a.formData.surname||(c.surname.$dirty=!0),a.formData.birthdate||(c.birthdate.$dirty=!0,c.birthdate.$setValidity("date",!1)),a.formData.sex||(c.sex.$dirty=!0),a.validSteps.formStep2=c.$valid,c.$valid&&b.go("form.step3")},a.submitStep3=function(c){a.formData.country||(c.country.$dirty=!0),a.formData.city||(c.city.$dirty=!0),a.formData.address||(c.address.$dirty=!0),a.formData.phone||(c.phone.$dirty=!0),a.validSteps.formStep3=c.$valid,c.$valid&&b.go("form.step4")},a.submitForm=function(){c.add("formData",a.formData),b.go("form.step1")},a.clearForm=function(){a.formData={},a.validSteps={},c.remove("formData"),b.go("form.step1")}}]),angular.module("regformApp").directive("match",function(){return{require:"ngModel",restrict:"A",scope:{match:"="},link:function(a,b,c,d){a.$watch(function(){var b=d.$modelValue||d.$$invalidModelValue;return d.$pristine&&angular.isUndefined(b)||a.match===b},function(a){d.$setValidity("match",a)})}}});